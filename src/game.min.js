kontra.init(),kontra.assets.imagePath='assets/images';var ac=new AudioContext,tempo=100,melody=['G3  1','E4  4','D4  1','E4  1','D4  3','C4  2','G3  1','E4  2','A3  0.5','Bb3  0.125','A3  0.125','G#3  0.125','A3  0.125','A4  2','E4  1','G4  3','F4  2','E4  1','D4  3','E4  2','B3  1','C4  3','A3  3','G3  1','B4  1','A4  1','G4  0.5','F4  0.5','E4  0.5','F4  0.5','A3  0.5','B3  0.5','C4  3','-  2'],bass=['C2  1','G2  1','C3  1','Ab2  1','B2  1','E3  1','G2  1','C3  1','E3  1','B2  1','C3  1','E3  1','A2  1','C#3  1','E3  1','A2  1','C#3  1','G3  1','D2  1','Bb2  1','C#3  1','D2  1','A2  1','D3  1','G2  1','B2  1','F3  1','G#2  1','E3  1','D3  1','A2  1','C3  1','E3  1','F#2  1','C3  1','Eb3  1','G2  1','C3  1','F3  1','G2  1','B3  1','F3  1','G2  1','C3  1','E3  1','G2  1','C3  1','E3  1'],seq_melody=new TinyMusic.Sequence(ac,tempo,melody);seq_melody.gain.gain.value=0.05,seq_melody.staccato=0.1,seq_melody.smoothing=0.1,seq_melody.waveType='sine';var seq_bass=new TinyMusic.Sequence(ac,tempo,bass);seq_bass.gain.gain.value=0.3,seq_bass.smoothing=0.1,seq_bass.waveType='sine';var wifi_down=['G4  0.3','E4  0.3','C4  0.3','G2  0.1','-  0.5'],wifi_up=['G2  0.3','C4  0.3','E4  0.3','G4  0.1','-  0.5'],match=['G3 0.25','G4 0.1'],fanfare=['C4  2','B3  1.5','F3  0.5','A3  1','G3  1','F3  1','D3  1','C3  1','B2  0.5','C3  0.5','D3  1','G2  1','C3  1'],seq_wifidown=new TinyMusic.Sequence(ac,180,wifi_down);seq_wifidown.gain.gain.value=0.05,seq_wifidown.smoothing=0.2,seq_wifidown.loop=!1;var seq_wifiup=new TinyMusic.Sequence(ac,180,wifi_up);seq_wifiup.gain.gain.value=0.05,seq_wifiup.smoothing=0.2,seq_wifiup.loop=!1;var seq_match=new TinyMusic.Sequence(ac,180,match);seq_match.gain.gain.value=0.4,seq_match.waveType='sine',seq_match.loop=!1;var seq_click=new TinyMusic.Sequence(ac,180,['G3 0.25']);seq_click.gain.gain.value=0.05,seq_click.loop=!1;var seq_fanfare=new TinyMusic.Sequence(ac,180,fanfare);seq_fanfare.gain.gain.value=0.3,seq_fanfare.waveType='triangle',seq_fanfare.staccato=0.1,seq_fanfare.loop=!1;var ROUTER_WIDTH=20,PERSON_WIDTH=15,PERSON_HEIGHT=30,WIFI_COLOR='mediumturquoise',LOVE_TYPES=[{id:0,symbol:'\u2648',color:'slateblue'},{id:1,symbol:'\u2649',color:'blueviolet'},{id:2,symbol:'\u264A',color:'magenta'},{id:3,symbol:'\u264B',color:'violet'},{id:4,symbol:'\u264C',color:'crimson'},{id:5,symbol:'\u264D',color:'darkorange'},{id:6,symbol:'\u264E',color:'gold'},{id:7,symbol:'\u264F',color:'greenyellow'},{id:8,symbol:'\u2650',color:'springgreen'},{id:9,symbol:'\u2651',color:'cyan'},{id:10,symbol:'\u2652',color:'dodgerblue'},{id:11,symbol:'\u2653',color:'blue'}],CURSOR_TYPE=-1,cursor=kontra.sprite({x:-100,y:-100,typeId:CURSOR_TYPE,color:'pink',boldColor:'magenta',radius:3,wifiDrain:20,isInCanvas:!1,wingSpanX:7,wingSpanY:2,wingTipX:12,wingTipY:10,cx:function(){return this.x+this.radius},cy:function(){return this.y+this.radius},isLinking:function(){return null!=this.link},showCursor:function(){cursor.isInCanvas=!0},hideCursor:function(){cursor.isInCanvas=!1},render:function(){ctx.strokeStyle=this.color,ctx.fillStyle=this.color,ctx.beginPath(),ctx.arc(this.x,this.y,this.radius,0,2*Math.PI),ctx.fill(),ctx.lineWidth=1,ctx.moveTo(this.x,this.y),ctx.lineTo(this.x-this.wingSpanX,this.y-this.wingSpanY),ctx.lineTo(this.x-this.wingTipX,this.y-this.wingTipY),ctx.lineTo(this.x,this.y),ctx.lineTo(this.x+this.wingSpanX,this.y-this.wingSpanY),ctx.lineTo(this.x+this.wingTipX,this.y-this.wingTipY),ctx.lineTo(this.x,this.y),ctx.stroke()}}),link=function(a,b){return kontra.sprite({entity1:a,entity2:b,linkColor:cursor.color,lovePower:0,maxLovePower:100,hSize:60,hx:function(){return Math.floor(this.entity1.cx()-(this.entity1.cx()-this.entity2.cx())/2)},hy:function(){return Math.floor(this.entity1.cy()-(this.entity1.cy()-this.entity2.cy())/2)},isMatch:function(){return a.typeId!=CURSOR_TYPE},isPerfectMatch:function(){return a.typeId==b.typeId},collidesWithCursor:function(){let c=cursor.cx()-this.hx(),d=cursor.cy()-this.hy();return Math.abs(c)<=this.hSize/2&&Math.abs(d)<=this.hSize/2},boostLove:{timer:null,boostInterval:150,boostAmount:10,start:function(){if(null==this.timer){var c=this;this.timer=window.setInterval(function(){c.run()},this.boostInterval),this.parent.boostAnimation.start()}},run:function(){this.parent.lovePower+=this.boostAmount/cursor.numBoostLove,this.parent.lovePower>=this.parent.maxLovePower&&(this.stop(),this.parent.success())},stop:function(){null!=this.timer&&(window.clearInterval(this.timer),this.timer=null,this.parent.boostAnimation.stop())}},drainLove:{timer:null,drainInterval:150,drainAmount:10,start:function(){if(null==this.timer){var c=this;this.timer=window.setInterval(function(){c.run()},this.drainInterval)}},run:function(){null==this.parent.boostLove.timer&&(this.parent.lovePower-=this.drainAmount,0>=this.parent.lovePower&&(this.stop(),this.parent.destroy()))},stop:function(){null!=this.timer&&(window.clearInterval(this.timer),this.timer=null)}},boostAnimation:{timer:null,emitInterval:40,dx:0,dxMax:16,dy:0,dyMin:3,dyMax:24,dyStep:3,color:cursor.boldColor,start:function(){if(null==this.timer){var c=this;this.dy=this.dyMin,this.dx=2*Math.random()*this.dxMax-this.dxMax,this.timer=window.setInterval(function(){c.run()},this.emitInterval)}},run:function(){this.dy+=this.dyStep,this.dy>=this.dyMax&&(this.dy=this.dyMin,this.dx=2*Math.random()*this.dxMax-this.dxMax)},stop:function(){null!=this.timer&&(window.clearInterval(this.timer),this.timer=null,this.dy=0,this.dx=0)},render:function(){let c=this.parent.hSize/3,d=this.x-c/3+this.dx,e=this.y+c/4-this.dy;ctx.font=c+'px Courier',ctx.fillStyle=cursor.boldColor,ctx.fillText('\u2665',d,e)}},success:function(){var c=this;c.destroy(),c.entity1.destroy(),c.entity2.destroy(),seq_match.play(),0==people.length&&window.setTimeout(function(){game.time.stop(),game.endLevel()},1e3)},render:function(){if(ctx.strokeStyle=this.linkColor,ctx.beginPath(),ctx.moveTo(this.entity1.cx(),this.entity1.cy()),ctx.lineTo(this.hx(),this.hy()),ctx.stroke(),this.isPerfectMatch()){let c=this.hx()-this.hSize/3,d=this.hy()+this.hSize/4,e=ctx.createLinearGradient(c,d-this.hSize,c,d),f=(0.9-0.9/this.maxLovePower*this.lovePower).toFixed(2);e.addColorStop(0,cursor.color),e.addColorStop(f,cursor.color),e.addColorStop(1,cursor.boldColor),ctx.font=this.hSize+'px Courier',ctx.fillStyle=e,ctx.fillText('\u2665',c,d)}ctx.beginPath(),ctx.moveTo(this.hx(),this.hy()),ctx.lineTo(this.entity2.cx(),this.entity2.cy()),ctx.stroke(),null!=this.boostAnimation.timer&&this.boostAnimation.render(),this.isMatch()&&this.entity1.drawLoveType(),this.entity2.drawLoveType()},init:function(){return this.entity1.link=this,this.entity2.link=this,this.boostLove.parent=this,this.drainLove.parent=this,this.boostAnimation.parent=this,this.boostAnimation.x=this.hx(),this.boostAnimation.y=this.hy(),this.isPerfectMatch()&&(this.linkColor=cursor.boldColor),this},destroy:function(){let c=links.indexOf(this);links.splice(c,1),a.link=null,b.link=null}}).init()},links=[],router=function(a,b){return kontra.sprite({x:a,y:b,color:'dimgrey',wifiUpColor:WIFI_COLOR,wifiLossColor:'lightgrey',wifiDownColor:'orange',width:ROUTER_WIDTH,height:ROUTER_WIDTH,radius:10,wifiPower:100,maxWifiPower:100,minWifiPower:-50,wifiRange:kontra.sprite({timer:null,emitInterval:30,radius:0,minRadius:20,maxRadius:200,radiusStep:5,start:function(){if(null==this.timer){var c=this;this.radius=this.minRadius,this.timer=window.setInterval(function(){c.run()},this.emitInterval)}},run:function(){this.radius+=this.radiusStep,this.radius>=this.maxRadius&&(this.radius=this.minRadius)},stop:function(){null!=this.timer&&(window.clearInterval(this.timer),this.timer=null,this.radius=0)},render:function(){ctx.strokeStyle=this.color,ctx.lineWidth=1.5,ctx.beginPath(),ctx.arc(this.x,this.y,this.radius,0,2*Math.PI),ctx.stroke()}}),cx:function(){return this.x+this.radius},cy:function(){return this.y+this.radius},isWifiDown:function(){return 0>this.wifiPower},collidesWithCursor:function(){let c=cursor.cx()-this.cx(),d=cursor.cy()-this.cy();return Math.abs(c)<=this.radius&&Math.abs(d)<=this.radius},drawStats:function(){this.isWifiDown()?(ctx.font='11px Arial',ctx.fillStyle=this.wifiDownColor):(ctx.font='11px Arial',ctx.fillStyle=this.wifiUpColor);let c=Math.ceil(this.wifiPower),d=parseInt(this.x+this.radius),e=parseInt(this.y+0.75*this.radius);if(ctx.lineWidth=3,ctx.strokeStyle=c>0.75*this.maxWifiPower?this.wifiUpColor:this.wifiLossColor,ctx.beginPath(),ctx.arc(d,parseInt(e+2*(this.radius/3)),parseInt(8*(this.radius/3)),1.28*Math.PI,1.72*Math.PI),ctx.stroke(),ctx.strokeStyle=c>0.5*this.maxWifiPower?this.wifiUpColor:this.wifiLossColor,ctx.beginPath(),ctx.arc(d,parseInt(e+this.radius/2),parseInt(6*(this.radius/3)),1.28*Math.PI,1.72*Math.PI),ctx.stroke(),ctx.strokeStyle=c>0.25*this.maxWifiPower?this.wifiUpColor:this.wifiLossColor,ctx.beginPath(),ctx.arc(d,parseInt(e+this.radius/3),parseInt(4*(this.radius/3)),1.28*Math.PI,1.72*Math.PI),ctx.stroke(),0<c)ctx.fillStyle=this.wifiUpColor;else{let f=ctx.createLinearGradient(d,e-this.radius/2,d,e+this.radius/2),g=(0.95/this.minWifiPower*c).toFixed(2);f.addColorStop(0,this.wifiLossColor),f.addColorStop(g,this.wifiLossColor),f.addColorStop(g,'white'),f.addColorStop(g,this.wifiDownColor),f.addColorStop(1,this.wifiDownColor),ctx.font=this.hSize+'px Courier',ctx.fillStyle=f}ctx.beginPath(),ctx.arc(d,e,this.radius/2,0,2*Math.PI),ctx.fill()},drainWifi:{timer:null,drainInterval:250,wifiDownDropToPower:-20,start:function(){if(null==this.timer){var c=this;this.timer=window.setInterval(function(){c.run()},this.drainInterval),this.parent.drainAnimation.start()}},run:function(){let c=this.parent.wifiPower;if(0<this.parent.wifiPower?this.parent.wifiPower-=cursor.wifiDrain:this.parent.wifiPower>this.parent.minWifiPower&&(this.parent.wifiPower>this.wifiDownDropToPower?this.parent.wifiPower=1.1*this.wifiDownDropToPower:(this.parent.wifiPower-=cursor.wifiDrain/4,this.parent.wifiPower<this.parent.minWifiPower&&(this.parent.wifiPower=this.parent.minWifiPower))),0<c&&0>=this.parent.wifiPower){this.parent.wifiRange.stop(),seq_wifidown.play(),this.parent.wifiPower=this.wifiDownDropToPower;for(var d=0;d<people.length;d++){let e=people[d];e.hasMatch()&&!e.hasWifi()&&e.link.drainLove.stop()}}},stop:function(){null!=this.timer&&(window.clearInterval(this.timer),this.timer=null,this.parent.drainAnimation.stop())}},recoverWifi:{timer:null,recoverInterval:100,start:function(){var c=this;this.timer=window.setInterval(function(){c.run()},this.recoverInterval)},run:function(){let c=this.parent.wifiPower;if(this.parent.wifiPower<this.parent.maxWifiPower&&(0<this.parent.wifiPower?(this.parent.wifiPower+=1,this.parent.wifiPower>this.parent.maxWifiPower&&(this.parent.wifiPower=this.parent.maxWifiPower)):this.parent.wifiPower+=0.25),0>=c&&0<this.parent.wifiPower){this.parent.wifiRange.start(),seq_wifiup.play();for(var d=0;d<people.length;d++){let e=people[d];e.hasMatch()&&e.hasWifi()&&e.link.drainLove.start()}}},stop:function(){window.clearInterval(this.timer),this.timer=null}},drainAnimation:{timer:null,emitInterval:40,radius:0,minRadius:3,maxRadius:24,radiusStep:3,color:'crimson',start:function(){if(null==this.timer){var c=this;this.radius=this.maxRadius,this.timer=window.setInterval(function(){c.run()},this.emitInterval)}},run:function(){this.radius-=this.radiusStep,this.radius<=this.minRadius&&(this.radius=this.maxRadius)},stop:function(){null!=this.timer&&(window.clearInterval(this.timer),this.timer=null,this.radius=0)},render:function(){ctx.strokeStyle=this.color,ctx.lineWidth=1.5,ctx.beginPath(),ctx.arc(this.x,this.y,this.radius,0,2*Math.PI),ctx.stroke()}},render:function(){this.draw(),this.wifiRange.render(),null!=this.drainAnimation.timer&&this.drainAnimation.render()},init:function(){this.drainWifi.parent=this,this.recoverWifi.parent=this,this.drainAnimation.parent=this,this.wifiRange.x=this.cx(),this.wifiRange.y=this.cy(),this.drainAnimation.x=this.cx(),this.drainAnimation.y=this.cy(),this.wifiRange.color=this.wifiUpColor;var c=this;return window.setTimeout(function(){c.wifiRange.start()},500*Math.random()),this.recoverWifi.start(),this}}).init()},routers=[],person=function(a,b,c){return kontra.sprite({x:a,y:b,typeId:c,color:'antiquewhite',width:PERSON_WIDTH,height:PERSON_HEIGHT,radiusX:PERSON_WIDTH/2,radiusY:PERSON_HEIGHT/2,headRad:PERSON_WIDTH,phone:kontra.sprite({color:'black',width:10,height:18,render:function(){this.draw(),ctx.fillStyle='lightgrey',ctx.fillRect(this.x+1,this.y+2,this.width-2,this.height-4),ctx.fillStyle='antiquewhite',ctx.beginPath(),ctx.arc(this.x+3,this.y+7,3,0,2*Math.PI),ctx.fill(),ctx.fillStyle='lightgrey'}}),cx:function(){return this.x+this.radiusX},cy:function(){return this.y+this.radiusY},isHypnotized:function(){return null!=this.link},hasMatch:function(){return this.isHypnotized()&&this.link.isMatch()},collidesWithCursor:function(){let d=cursor.cx()-this.cx(),e=cursor.cy()-this.cy();return Math.abs(d)<=this.radiusX+2&&Math.abs(e)<=this.radiusY+this.headRad},hasWifi:function(){for(var d=0;d<routers.length;d++)if(!routers[d].isWifiDown()){let e=routers[d].wifiRange,f=e.x-this.cx(),g=e.y-this.cy(),h=Math.sqrt(f*f+g*g);if(h<=e.maxRadius)return!0}return!1},render:function(){this.draw(),this.hasWifi()&&!this.isHypnotized()&&this.phone.render(),this.isHypnotized()&&(ctx.strokeStyle=this.link.isPerfectMatch()?cursor.boldColor:cursor.color,ctx.lineWidth=3,ctx.beginPath(),ctx.arc(this.x+this.radiusX,this.y,this.headRad,0,2*Math.PI),ctx.stroke(),ctx.strokeRect(this.x-1,this.y-1,this.width+2,this.height+2),ctx.strokeStyle=this.color),ctx.beginPath(),ctx.arc(this.x+this.radiusX,this.y,this.headRad,0,2*Math.PI),ctx.fill(),ctx.fillStyle='black',ctx.font='12px Courier',this.hasWifi()&&!this.isHypnotized()?ctx.fillText('  ._.',this.x-this.radiusX,this.cy()-2*this.radiusX):this.isHypnotized()&&this.link.isPerfectMatch()?ctx.fillText(' \u2665_\u2665',this.x-this.radiusX,this.cy()-2*this.radiusX):!this.hasWifi()&&ctx.fillText(' ._.',this.x-this.radiusX,this.cy()-2*this.radiusX)},drawLoveType:function(){let d=LOVE_TYPES[this.typeId];ctx.font='18px Courier',ctx.fillStyle=d.color,ctx.fillText(d.symbol,this.x-0.15*this.radiusX,this.cy()+0.6*this.radiusX)},init:function(){return this.phone.parent=this,this.phone.x=this.x+0.75*this.width+5,this.phone.y=this.y+0.25*this.height,this},destroy:function(){let d=people.indexOf(this);people.splice(d,1)}}).init()},people=[],NUM_ROUTERS=3,NUM_PEOPLE=16,START_MIN=4,START_SEC=0,START_LEVEL=1,START_STATE=0,game={state:null,states:{TITLE:0,STARTLEVEL:1,INLEVEL:2,ENDLEVEL:3},time:{min:0,sec:0,startMin:0,startSec:0,timer:null,getTotalSecLeft:function(){return 60*game.time.min+game.time.sec},start:function(){var a=this;this.min=this.startMin,this.sec=this.startSec,this.timer=window.setInterval(function(){0==a.sec?0==a.min?(game.endLevel(),a.stop()):(a.min-=1,a.sec=59):a.sec-=1},1e3)},stop:function(){window.clearInterval(this.timer),this.timer=null},render:function(){ctx.fillStyle='black',ctx.font='14px Arial';let a=this.min,b=this.sec;10>a&&(a='0'+a),10>b&&(b='0'+b),ctx.fillText(a+':'+b,490,16)},reset:function(){this.stop(),this.start()}},screen:{overlay:kontra.sprite({x:0,y:0,width:1e3,height:1e3,color:'black',render:function(){ctx.globalAlpha=0.7,this.draw(),ctx.globalAlpha=1}}),render:function(){game.state!=game.states.INLEVEL&&this.overlay.render(),game.screens[game.state].render()}},btn:kontra.sprite({x:195,y:250,width:135,height:30,color:WIFI_COLOR,text:'',cx:function(){return this.x+this.width/2},cy:function(){return this.y+this.height/2},collidesWithCursor:function(){let a=cursor.cx()-this.cx(),b=cursor.cy()-this.cy();return Math.abs(a)<=this.width/2&&Math.abs(b)<=this.height/2},render:function(){this.draw(),ctx.fillStyle=cursor.boldColor,ctx.font='bold 20px Arial';let a=this.x;'TRY AGAIN'==this.text?a+=14:'NEXT LEVEL'==this.text?a+=8:'PLAY'==this.text&&(a+=43),ctx.fillText(this.text,a,this.y+22),ctx.lineWidth=1,ctx.strokeStyle=cursor.boldColor,ctx.strokeRect(this.x-1,this.y-1,this.width+2,this.height+2)}}),nextState:function(){let a=game.state+1;a>=game.states.ENDLEVEL&&(a=game.states.STARTLEVEL),game.load(game.level,a),game.screenTimer=null},screens:[{router:null,person1:null,person2:null,link:null,load:function(){game.btn.text='PLAY',this.router=router(224,145),this.person1=person(-30,250,1),this.person2=person(768,10,1),this.link=link(this.person1,this.person2),this.link.lovePower=this.link.maxLovePower,this.router.color='#393939'},render:function(){this.router.render(),this.router.drawStats(),this.link.render(),ctx.font='48px Arial',ctx.fillStyle=cursor.boldColor,ctx.fillText('HOTSPOT',48,180),ctx.fillStyle=WIFI_COLOR,ctx.fillText('HOTSPOT',51,180),ctx.fillStyle=WIFI_COLOR,ctx.fillText('LOVERS',296,180),ctx.fillStyle=cursor.boldColor,ctx.fillText('LOVERS',299,180),game.btn.render()}},{timer:null,isEndGame:!1,load:function(a){this.isEndGame=a,a||(this.screenTimer=window.setTimeout(function(){game.state=game.states.INLEVEL;game.levels[game.level-1];game.time.stop(),game.time.start(),game.screenTimer=null},5e3))},render:function(){this.isEndGame?(ctx.font='52px Arial',ctx.fillStyle=cursor.boldColor,ctx.fillText('YOU WIN!',140,180),ctx.font='20px Arial',ctx.fillText('Now it\'s your turn to go OFFLINE and find your love!',40,240)):(ctx.font='60px Arial',ctx.fillStyle=cursor.boldColor,ctx.fillText('LEVEL '+game.level,150,180),ctx.font='24px Arial',ctx.fillText('Get ready!',210,240))}},{render:function(){game.time.render()}},{text:'',subText:'',textX:0,subTextX:0,timer:null,load:function(){let a=game.time.getTotalSecLeft();if(0<game.time.getTotalSecLeft()){let b=60*game.time.startMin+game.time.startSec,c=b-a,d=Math.floor(c/60),e=c%60;10>e&&(e='0'+e),seq_fanfare.play(),this.text='LEVEL CLEARED!',this.subText='Time taken: '+d+':'+e,this.textX=50,this.subTextX=185,0<game.level&&(game.level+=1),game.btn.text='NEXT LEVEL'}else this.text='GAME OVER!',this.subText='You ran out of time!',this.textX=100,this.subTextX=180,game.btn.text='TRY AGAIN'},render:function(){ctx.font='52px Arial',ctx.fillStyle=cursor.boldColor,ctx.fillText(this.text,this.textX,150),ctx.font='20px Arial',ctx.fillText(this.subText,this.subTextX,210),game.btn.render()}}],reset:function(){this.time.reset(),people.splice(0,people.length),routers.splice(0,routers.length),links.splice(0,links.length)},level:0,levels:[{numRouters:1,numPeople:12,startMin:1,startSec:30},{numRouters:2,numPeople:14,startMin:2,startSec:20},{numRouters:2,numPeople:18,startMin:2,startSec:40},{numRouters:3,numPeople:20,startMin:3,startSec:0},{numRouters:4,numPeople:22,startMin:3,startSec:30},{numRouters:5,numPeople:24,startMin:4,startSec:0}],load:function(a,b){let c=0.5,d=0.2,e=0.7,f=0.05,g=0.85,h=2;if(this.state=b,b==this.states.TITLE&&(this.level=a),b!=this.states.STARTLEVEL)return void this.screens[b].load();let j=a>this.levels.length;if(this.screens[b].load(j),!j){let l=0,m=0,n=0,o=0;for(0<a?(game.level=a,l=this.levels[a-1].numRouters,m=this.levels[a-1].numPeople,n=this.levels[a-1].startMin,o=this.levels[a-1].startSec):(l=NUM_ROUTERS,m=NUM_PEOPLE,n=START_MIN,o=START_SEC),game.time.startMin=n,game.time.startSec=o;routers.length<l;){let q=Math.floor((Math.random()*(e-d)+d)*canvasMaxWidth*canvasWidthRatio),r=Math.floor((Math.random()*(e-d)+d)*canvasMaxHeight*canvasWidthRatio),s=!1;for(var k=0;k<routers.length;k++)if(Math.abs(routers[k].x-q)<canvasMaxWidth*canvasWidthRatio*c/l&&Math.abs(routers[k].y-r)<canvasMaxHeight*canvasWidthRatio*c/l){s=!0;break}s||routers.push(router(q,r))}let p=0;for(1==m%2&&(m-=1);people.length<m;){p>=2*LOVE_TYPES.length&&(p=0);let q=Math.floor(p/2),r=Math.floor((Math.random()*(g-f)+f)*canvasMaxWidth*canvasWidthRatio),s=Math.floor((Math.random()*(g-f)+f)*canvasMaxHeight*canvasWidthRatio),t=!1;for(var k=0;k<routers.length;k++)if(Math.abs(routers[k].x-r)<PERSON_WIDTH*h&&Math.abs(routers[k].y-s)<PERSON_HEIGHT*h){t=!0;break}if(!t){for(var k=0;k<people.length;k++)if(Math.abs(people[k].x-r)<PERSON_WIDTH*h&&Math.abs(people[k].y-s)<PERSON_HEIGHT*h){t=!0;break}if(!t){let u=person(r,s,q);u.hasWifi()&&(people.push(u),p+=1)}}}}},endLevel:function(){window.clearTimeout(this.screens[this.state].screenTimer),this.screens[this.state].screenTimer=null,this.state=this.states.ENDLEVEL,this.screens[this.state].load(),this.reset()}};game.load(START_LEVEL,START_STATE),kontra.pointer.onDown(function(){if(game.state==game.states.INLEVEL){for(var c=0;c<people.length;c++)if(people[c].collidesWithCursor()){if(people[c].hasWifi()||people[c].hasMatch()&&people[c].link.isPerfectMatch())cursor.isLinking()||cursor.link.destroy();else if(seq_click.play(),people[c].hasMatch()&&!people[c].link.isPerfectMatch()&&people[c].link.destroy(),!cursor.isLinking())links.push(link(cursor,people[c]));else{let d=cursor.link.entity2;cursor.link.destroy(),people[c]!=d&&links.push(link(d,people[c]))}return}cursor.isLinking()&&cursor.link.destroy()}else game.btn.collidesWithCursor()&&game.nextState()});var loop=kontra.gameLoop({update:function(){if(cursor.isInCanvas&&(cursor.x=kontra.pointer.x*canvasWidthRatio,cursor.y=kontra.pointer.y*canvasWidthRatio),game.state==game.states.INLEVEL){let b=0;for(var a=0;a<links.length;a++)links[a].isPerfectMatch()&&(links[a].collidesWithCursor()?(links[a].boostLove.start(),b++):links[a].boostLove.stop());if(cursor.numBoostLove=b,0==b)for(var a=0;a<routers.length;a++)routers[a].collidesWithCursor()?routers[a].drainWifi.start():routers[a].drainWifi.stop()}},render:function(){ctx.fillStyle='darkgrey',ctx.fillRect(0,0,1e3,1e3);for(var a=0;a<routers.length;a++)routers[a].render();for(var a=0;a<people.length;a++)people[a].render();for(var a=0;a<links.length;a++)links[a].render();for(var a=0;a<routers.length;a++)routers[a].drawStats();game.screen.render(),cursor.isInCanvas&&cursor.render()}});loop.start(),when=ac.currentTime,seq_melody.play(when),seq_bass.play(when+1*(60/tempo));